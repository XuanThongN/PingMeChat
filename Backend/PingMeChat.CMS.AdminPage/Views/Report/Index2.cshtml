<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PosApp - Báo cáo Tiêu thụ và Lợi nhuận Sản phẩm</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
    <style>
        .card {
            margin-bottom: 20px;
        }

        .summary-box {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }

            .summary-box h3 {
                margin-bottom: 10px;
            }

        .top-products {
            background-color: #e9ecef;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }

            .top-products h3 {
                margin-bottom: 10px;
            }

            .top-products ul {
                list-style-type: none;
                padding-left: 0;
            }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1 class="mb-4">Báo cáo Tiêu thụ và Lợi nhuận Sản phẩm</h1>

        <div class="row mb-4">
            <div class="col-md-3">
                <select class="form-select" id="reportType">
                    <option value="day">Theo ngày</option>
                    <option value="week">Theo tuần</option>
                    <option value="month">Theo tháng</option>
                    <option value="quarter">Theo quý</option>
                    <option value="year">Theo năm</option>
                </select>
            </div>
            <div class="col-md-5">
                <input type="text" class="form-control" id="dateRange" placeholder="Chọn khoảng thời gian">
            </div>
            <div class="col-md-2">
                <select class="form-select" id="productType">
                    <option value="all">Tất cả sản phẩm</option>
                    <option value="billiards">Bàn bida</option>
                    <option value="drinks">Đồ uống</option>
                    <option value="food">Thức ăn</option>
                </select>
            </div>
            <div class="col-md-2">
                <button class="btn btn-primary w-100" id="generateReport">Tạo báo cáo</button>
            </div>
        </div>

        <div class="row">
            <div class="col-md-4">
                <div class="summary-box">
                    <h3>Tổng doanh thu</h3>
                    <h2 id="totalRevenue">0 đ</h2>
                </div>
            </div>
            <div class="col-md-4">
                <div class="summary-box">
                    <h3>Tổng lợi nhuận</h3>
                    <h2 id="totalProfit">0 đ</h2>
                </div>
            </div>
            <div class="col-md-4">
                <div class="top-products">
                    <h3>Top 5 sản phẩm bán chạy</h3>
                    <ul id="topProductsList">
                        <!-- Danh sách sẽ được điền bằng JavaScript -->
                    </ul>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Biểu đồ Doanh thu và Lợi nhuận</h5>
                <canvas id="revenueChart"></canvas>
            </div>
        </div>

        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Chi tiết Sản phẩm</h5>
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Sản phẩm</th>
                            <th>Loại</th>
                            <th>Số lượng tiêu thụ</th>
                            <th>Doanh thu</th>
                            <th>Lợi nhuận</th>
                        </tr>
                    </thead>
                    <tbody id="productDetailsTable">
                        <!-- Dữ liệu sẽ được thêm vào đây bằng JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>

        <div class="text-end mt-3">
            <button class="btn btn-success me-2" id="exportPDF">Xuất PDF</button>
            <button class="btn btn-success" id="exportExcel">Xuất Excel</button>
        </div>
    </div>

    <script>
        let revenueChart;

        $(document).ready(function () {
            $('#dateRange').daterangepicker({
                opens: 'left',
                locale: {
                    format: 'DD/MM/YYYY'
                }
            });

            const ctx = document.getElementById('revenueChart').getContext('2d');
            revenueChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'Doanh thu',
                            data: [],
                            backgroundColor: 'rgba(75, 192, 192, 0.6)',
                        },
                        {
                            label: 'Lợi nhuận',
                            data: [],
                            backgroundColor: 'rgba(255, 99, 132, 0.6)',
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            $('#generateReport').click(generateReport);
            $('#exportPDF').click(exportPDF);
            $('#exportExcel').click(exportExcel);
        });

        function generateReport() {
            const reportType = $('#reportType').val();
            const dateRange = $('#dateRange').val();
            const productType = $('#productType').val();

            // Giả lập dữ liệu (trong thực tế, bạn sẽ gọi API để lấy dữ liệu)
            const data = generateMockData(reportType, dateRange, productType);

            updateChart(data);
            updateSummary(data);
            updateTopProducts(data);
            updateProductDetails(data);
        }

        function generateMockData(reportType, dateRange, productType) {
            // Giả lập dữ liệu cho mục đích demo
            const products = [
                { name: 'Bàn bida 1', type: 'billiards' },
                { name: 'Bàn bida 2', type: 'billiards' },
                { name: 'Bia', type: 'drinks' },
                { name: 'Nước ngọt', type: 'drinks' },
                { name: 'Snack', type: 'food' },
                { name: 'Bánh mì', type: 'food' }
            ];

            const data = products.map(product => {
                const quantity = Math.floor(Math.random() * 100) + 1;
                const revenue = quantity * (Math.floor(Math.random() * 50000) + 10000);
                const profit = revenue * (Math.random() * 0.4 + 0.1); // 10-50% lợi nhuận
                return {
                    ...product,
                    quantity,
                    revenue,
                    profit
                };
            });

            if (productType !== 'all') {
                return data.filter(item => item.type === productType);
            }

            return data;
        }

        function updateChart(data) {
            revenueChart.data.labels = data.map(item => item.name);
            revenueChart.data.datasets[0].data = data.map(item => item.revenue);
            revenueChart.data.datasets[1].data = data.map(item => item.profit);
            revenueChart.update();
        }

        function updateSummary(data) {
            const totalRevenue = data.reduce((sum, item) => sum + item.revenue, 0);
            const totalProfit = data.reduce((sum, item) => sum + item.profit, 0);

            $('#totalRevenue').text(formatCurrency(totalRevenue));
            $('#totalProfit').text(formatCurrency(totalProfit));
        }

        function updateTopProducts(data) {
            const sortedProducts = [...data].sort((a, b) => b.quantity - a.quantity).slice(0, 5);
            const topProductsList = $('#topProductsList');
            topProductsList.empty();

            sortedProducts.forEach(product => {
                topProductsList.append(`<li>${product.name} - ${product.quantity} đơn vị</li>`);
            });
        }

        function updateProductDetails(data) {
            const tableBody = $('#productDetailsTable');
            tableBody.empty();

            data.forEach(item => {
                tableBody.append(`
                            <tr>
                                <td>${item.name}</td>
                                <td>${getProductTypeText(item.type)}</td>
                                <td>${item.quantity}</td>
                                <td>${formatCurrency(item.revenue)}</td>
                                <td>${formatCurrency(item.profit)}</td>
                            </tr>
                        `);
            });
        }

        function getProductTypeText(type) {
            switch (type) {
                case 'billiards': return 'Bàn bida';
                case 'drinks': return 'Đồ uống';
                case 'food': return 'Thức ăn';
                default: return 'Khác';
            }
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(amount);
        }

        function exportPDF() {
            alert('Chức năng xuất PDF sẽ được thực hiện ở đây');
            // Trong thực tế, bạn sẽ sử dụng thư viện như jsPDF để tạo file PDF
        }

        function exportExcel() {
            alert('Chức năng xuất Excel sẽ được thực hiện ở đây');
            // Trong thực tế, bạn sẽ sử dụng thư viện như SheetJS để tạo file Excel
        }
    </script>
</body>
</html>